select td.transport_details_id from CIS_TRANSPORT_DETAILS td , CIS_TRANSPORT t where 
t.TRANSPORTID = td.TRANSPORTID and t.status in (4,5) and td.status_id is NULL;

select e.event_id from CIS_EVENT e , CIS_TRANSPORT_DETAILS td 
where e.category = 'ITT' and e.TABLENAME = 'CIS_TRANSPORT_DETAILS' 
      AND ((e.event_status IN (20,6)) or (e.event_status  = 10 AND e.event_type 
='FOLLOWUP' ))
      AND e.column_id = td.TRANSPORT_DETAILS_id and td.status_id = 4;

CREATE OR REPLACE PROCEDURE UPDATE_TRANSPORT_DETAILS AS
CURSOR cur is select td.* from CIS_TRANSPORT_DETAILS td , CIS_TRANSPORT t where 
t.TRANSPORTID = td.TRANSPORTID and t.status in (4,5) and td.status_id is NULL ;
BEGIN
for row_record in cur 
loop
insert into CIS_TRANSPORT_DETAILS_AUDIT(
	TRANSPORT_DETAILS_ID, TRANSPORTID,STATUS_ID,PRODUCER,PRODUCER_COUNTRYID,
	ACTUAL_BUYER,BOL_ENDORSEE,SURVEYOR,CUSTODIAN,CUSTODIAN_COUNTRYID,
	LOADING_PORT,LOADING_PORT_COUNTRYID,VESSEL_NAME,VESSEL_IMO,VESSEL_OWNER,
	V_OWNER_COUNTRYID,VESSEL_FLAG,VESSEL_OPERATOR,V_OPERATOR_COUNTRYID,
	ORIGIN_COUNTRYID,DESTINATION_COUNTRYID,COMPANY_NAME,TRANSHIP_PORT_COUNTRYID,
	FORWARDER_COMPANY,AGENT,CAPTAIN,INSPECTOR,INSPECTOR_COUNTRYID,NOTIFY_PARTY,
	NOTIFY_PARTY_COUNTRYID,DISCHARGE_PORT,DISCHARGE_PORT_COUNTRYID,COMMERCIAL_OPERATOR,
	COMMERCIAL_OPERATOR_COUNTRYID,DISPONENT_OWNER,DISPONENT_OWNER_COUNTRYID,MANNING_AGENCY,
	CASE_OF_NEED_COUNTRYID,PNL_INSURANCE,SANCTION1_NAME,SANCTION1_COUNTRYID,SANCTION2_NAME,
	SANCTION2_COUNTRYID,SANCTION3_NAME,SANCTION3_COUNTRYID,SANCTION4_NAME,SANCTION4_COUNTRYID,
	SANCTION5_NAME,SANCTION5_COUNTRYID,IS_SCB_ACCEPTED_VESSEL,IS_TER_ACCEPTED_VESSEL,IS_PERFORMING_VESSEL
) values(row_record.TRANSPORT_DETAILS_ID, row_record.TRANSPORTID, row_record.STATUS_ID, row_record.PRODUCER, 
row_record.PRODUCER_COUNTRYID, row_record.ACTUAL_BUYER, row_record.BOL_ENDORSEE, row_record.SURVEYOR, 
row_record.CUSTODIAN, row_record.CUSTODIAN_COUNTRYID, row_record.LOADING_PORT, row_record.LOADING_PORT_COUNTRYID, 
row_record.VESSEL_NAME, row_record.VESSEL_IMO, row_record.VESSEL_OWNER, row_record.V_OWNER_COUNTRYID, 
row_record.VESSEL_FLAG, row_record.VESSEL_OPERATOR, row_record.V_OPERATOR_COUNTRYID, row_record.ORIGIN_COUNTRYID, 
row_record.DESTINATION_COUNTRYID, row_record.COMPANY_NAME, row_record.TRANSHIP_PORT_COUNTRYID, 
row_record.FORWARDER_COMPANY, row_record.AGENT, row_record.CAPTAIN, row_record.INSPECTOR, 
row_record.INSPECTOR_COUNTRYID, row_record.NOTIFY_PARTY, row_record.NOTIFY_PARTY_COUNTRYID, row_record.DISCHARGE_PORT, 
row_record.DISCHARGE_PORT_COUNTRYID, row_record.COMMERCIAL_OPERATOR, row_record.COMMERCIAL_OPERATOR_COUNTRYID, 
row_record.DISPONENT_OWNER, row_record.DISPONENT_OWNER_COUNTRYID, row_record.MANNING_AGENCY, 
row_record.CASE_OF_NEED_COUNTRYID, row_record.PNL_INSURANCE, row_record.SANCTION1_NAME, row_record.SANCTION1_COUNTRYID, 
row_record.SANCTION2_NAME, row_record.SANCTION2_COUNTRYID, row_record.SANCTION3_NAME, row_record.SANCTION3_COUNTRYID, 
row_record.SANCTION4_NAME, row_record.SANCTION4_COUNTRYID, row_record.SANCTION5_NAME, row_record.SANCTION5_COUNTRYID, 
row_record.IS_SCB_ACCEPTED_VESSEL, row_record.IS_TER_ACCEPTED_VESSEL, row_record.IS_PERFORMING_VESSEL);

end loop;
END UPDATE_TRANSPORT_DETAILS;
/
DECLARE 
BEGIN 
    UPDATE_TRANSPORT_DETAILS();
END;

insert into to_data(id,name) values(a,b); 


UPDATE CIS_TRANSPORT_DETAILS SET status_id = 4 WHERE transport_details_id in (
select td.transport_details_id from CIS_TRANSPORT_DETAILS td , CIS_TRANSPORT t where 
t.TRANSPORTID = td.TRANSPORTID and t.status in (4,5) and td.status_id is NULL);


UPDATE CIS_EVENT SET event_status = 50 WHERE event_id in (
select e.event_id from CIS_EVENT e , CIS_TRANSPORT_DETAILS td 
where e.category = 'ITT' and e.TABLENAME = 'CIS_TRANSPORT_DETAILS' 
      AND ((e.event_status IN (20,6)) or (e.event_status  = 10 AND e.event_type 
='FOLLOWUP' ))
      AND e.column_id = td.TRANSPORT_DETAILS_id and td.status_id = 4);

UPDATE CIS_EVENT SET event_status = 50 WHERE event_id in (      
select e.event_id from CIS_EVENT e , CIS_TRANSPORT_DETAILS td 
where e.category = 'ITT' and e.TABLENAME = 'CIS_TRANSPORT_DETAILS' 
      AND ((e.event_status IN (20,6)) or (e.event_status  = 10 AND e.event_type ='FOLLOWUP' ))
      AND e.column_id = td.TRANSPORT_DETAILS_id and e.event_status = 20
      AND (td.IS_SCB_ACCEPTED_VESSEL != 1 or td.IS_TER_ACCEPTED_VESSEL != 1 or td.IS_PERFORMING_VESSEL != 1));
